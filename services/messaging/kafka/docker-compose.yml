name: kafka

services:
  kafka:
    image: bitnami/kafka:${KAFKA_VERSION:-latest}
    container_name: kafka
    environment:
      # KRaft mode (no Zookeeper required)
      - KAFKA_ENABLE_KRAFT=yes
      - KAFKA_CFG_PROCESS_ROLES=broker,controller
      - KAFKA_CFG_CONTROLLER_LISTENER_NAMES=CONTROLLER
      - KAFKA_BROKER_ID=${KAFKA_BROKER_ID:-1}
      - KAFKA_CFG_NODE_ID=${KAFKA_NODE_ID:-1}
      - KAFKA_CFG_CONTROLLER_QUORUM_VOTERS=${KAFKA_CONTROLLER_QUORUM_VOTERS:-1@127.0.0.1:9093}
      # Listeners
      - KAFKA_CFG_LISTENERS=PLAINTEXT://:9092,CONTROLLER://:9093,EXTERNAL://:9094
      - KAFKA_CFG_ADVERTISED_LISTENERS=PLAINTEXT://127.0.0.1:9092,EXTERNAL://127.0.0.1:9094
      - KAFKA_CFG_LISTENER_SECURITY_PROTOCOL_MAP=CONTROLLER:PLAINTEXT,PLAINTEXT:PLAINTEXT,EXTERNAL:PLAINTEXT
      # Topic settings
      - KAFKA_AUTO_CREATE_TOPICS_ENABLE=${KAFKA_AUTO_CREATE_TOPICS:-true}
      - KAFKA_CFG_NUM_PARTITIONS=${KAFKA_NUM_PARTITIONS:-2}
      # Security
      - ALLOW_PLAINTEXT_LISTENER=yes
      # Debug (optional)
      - BITNAMI_DEBUG=${KAFKA_DEBUG:-no}
    ports:
      - "${KAFKA_PLAINTEXT_PORT:-9092}:9092"
      - "${KAFKA_EXTERNAL_PORT:-9094}:9094"
    volumes:
      - kafka-data:/bitnami
    restart: unless-stopped

volumes:
  kafka-data:
    name: kafka-data
